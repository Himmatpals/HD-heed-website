<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HD HeeD ‚Äî NDIS Weekly Follow‚Äëup Board</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet"/>
<style>
  /* === HD HeeD look ‚Äî navy + gold === */
  :root{
    --ink:#0c1226; --bg:#0b0f1a; --panel:#10172a; --line:#243153; --text:#e8edff; --muted:#a8b6e8; --accent:#ffc107;
    --good:#31d0aa; --warn:#ffd95c; --danger:#ff5d5d;
  }
  * { box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0; font-family:Inter,system-ui,Arial,sans-serif;
    color:var(--text); background:radial-gradient(1200px 1200px at 80% -200px,#122048 0%,#0b0f1a 42%,#0b0f1a 100%);
    padding:24px;
  }
  .shell{
    max-width:1200px; margin:0 auto; background:linear-gradient(180deg,#10172a,#0b0f1a);
    border:1px solid var(--line); border-radius:18px; box-shadow:0 28px 110px rgba(0,0,0,.55);
    overflow:hidden;
  }
  .head{
    display:flex; align-items:center; gap:12px; padding:16px 18px;
    border-bottom:1px solid var(--line); background:linear-gradient(180deg,#0e162f,#0c1329);
    position:sticky; top:0; z-index:2;
  }
  .badge{
    width:42px;height:42px;border-radius:10px;display:grid;place-items:center;
    font-weight:900; color:#2a2100; background:linear-gradient(135deg,#ffd95c,#ffe78f);
    box-shadow:0 8px 24px rgba(0,0,0,.35);
  }
  .title{ font-weight:900; font-size:1.15rem; letter-spacing:.2px; }
  .sub{ font-size:.88rem; color:var(--muted); }
  .toolbar{ margin-left:auto; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .pill{ border:1px solid var(--line); background:#0f1937; border-radius:999px; padding:6px 10px; font-size:.78rem; color:#cfe0ff; }
  .btn{
    border:1px solid var(--line); background:#0f1b3b; color:var(--text);
    border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer;
  }
  .btn.primary{ background:var(--accent); color:#2a2100; border-color:#e0b200; box-shadow:0 12px 34px rgba(0,0,0,.35); }
  .btn:disabled{ opacity:.55; cursor:not-allowed; }
  .status{ font-size:.8rem; color:var(--muted); }
  .wrap{ padding:16px; }
  .board{ border:1px solid var(--line); background:#0e162e; border-radius:16px; overflow:auto; }
  table{ border-collapse:separate; border-spacing:0; width:100%; min-width:1100px; }
  th,td{ border-bottom:1px solid var(--line); border-right:1px solid var(--line); padding:10px; vertical-align:top; }
  th:first-child, td:first-child{ border-left:1px solid var(--line); }
  thead th{
    position:sticky; top:0; background:#0d1428; color:var(--text); font-weight:900; font-size:.96rem; z-index:1;
  }
  tbody th{
    background:linear-gradient(180deg,#101a3c,#0e162f); text-align:left; font-weight:800; white-space:nowrap; min-width:380px;
  }
  .lead{ display:flex; flex-direction:column; gap:6px; }
  .lead .name{ font-weight:900; color:#ffe28f; text-shadow:0 0 0 transparent; }
  .lead .meta{ display:flex; gap:12px; flex-wrap:wrap; font-size:.85rem; color:#cfe0ff; }
  .lead .meta a{ color:#aee6ff; text-decoration:none; border-bottom:1px dotted rgba(174,230,255,.35); padding-bottom:1px; }
  .lead .meta a:hover{ color:#fff; border-bottom-color:#fff; }
  textarea{
    width:100%; min-height:80px; border:1px solid #2a3b68; border-radius:10px; padding:8px;
    background:#0f1b3b; color:#e8edff; resize:vertical; font-family:inherit; font-size:.92rem;
  }
  .hint{ font-size:.8rem; color:var(--muted); margin-top:8px; }
  .foot{ border-top:1px dashed var(--line); padding:12px 18px; display:flex; gap:10px; align-items:center; justify-content:space-between; }
  .badge-ok{ color:#083; }
  .badge-warn{ color:#9a6a00; }
  .badge-error{ color:#b30021; }
  @media (max-width:820px){
    .title{ font-size:1rem; }
    tbody th{ min-width:300px; }
  }
  /* Print-friendly */
  @media print{
    .toolbar, .foot{ display:none !important; }
    body{ padding:0; background:#fff; color:#000; }
    .shell{ border:none; box-shadow:none; }
    thead th{ background:#eee; color:#000; }
    tbody th{ background:#f9f9f9; color:#000; }
    textarea{ background:#fff; color:#000; border:1px solid #ccc; }
  }
</style>
</head>
<body>
  <div class="shell">
    <div class="head">
      <div class="badge">HD</div>
      <div>
        <div class="title">HD HeeD ‚Äî NDIS Weekly Follow‚Äëup Board</div>
        <div class="sub">Support Coordinators & Plan Managers ‚Ä¢ Blacktown & Western Sydney</div>
      </div>
      <div class="toolbar">
        <button id="btnRefresh" class="btn">üîÑ Refresh</button>
        <button id="btnSave" class="btn primary">üíæ Save changes</button>
        <span id="status" class="status"></span>
        <span class="pill">Shared ‚Ä¢ Live</span>
      </div>
    </div>

    <div class="wrap">
      <div class="board">
        <table id="board">
          <thead>
            <tr>
              <th style="width:380px">Lead (SC/PM)</th>
              <th>Monday</th><th>Tuesday</th><th>Wednesday</th>
              <th>Thursday</th><th>Friday</th><th>Saturday</th><th>Sunday</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="hint">Tip: type your note in any day cell (e.g., ‚ÄúCalled, left voicemail ‚Ä¢ ring back Thu 3pm‚Äù), then click <strong>Save changes</strong>. Anyone with this link will see the saved notes.</div>
    </div>

    <div class="foot">
      <div class="status" id="footStatus">Ready.</div>
      <div class="status">¬© HD HeeD Pty Ltd</div>
    </div>
  </div>

<script>
  // === Backend endpoint (Google Apps Script Web App) ===
  const API = "https://script.google.com/macros/s/AKfycbzwXW3Aabus6brnuawF9QvXX4dpq3MM03jmi4e9rkpiJUs2B9Vo_Qp36ht5BZ7bgbM/exec";

  // === Static contact details for pretty first column (name must match Sheet column A) ===
  const CONTACTS = {
    "Taylor McGuiness ‚Äî Interaction": {
      phone: "1300 668 123",
      email: "info@interactionservices.org",
      website: "https://interactionservices.org"
    },
    "Assist Disability Services ‚Äî SSC": {
      phone: "1800 955 806",
      email: "enquiries@assistservices.com.au",
      website: "https://assistservices.com.au"
    },
    "Triniti Care ‚Äî Support Coord": {
      phone: "(02) 8319 9433",
      website: "https://triniticare.com.au"
    },
    "MD Home Care ‚Äî SSC": {
      phone: "08 6386 9999",
      website: "https://mdhomecare.com.au"
    },
    "Claremont Care ‚Äî SC/PM": {
      phone: "0416 873 319",
      website: "https://claremontcare.com.au"
    },
    "BRK Plan Management": {
      phone: "0414 704 279",
      email: "meet@brkpm.com.au",
      website: "http://brkpm.com.au"
    },
    "Axial Plan Management": {
      phone: "0416 428 261",
      email: "hello@axialplanmanagement.com.au",
      website: "https://axialplanmanagement.com.au"
    },
    "NADO Plan Management": {
      phone: "1300 738 229",
      website: "https://nado.org.au"
    },
    "Yahweh Care ‚Äî PM": {
      phone: "(02) 8325 1616",
      email: "info@yahwehcare.com.au",
      website: "https://yahwehcare.com.au"
    }
  };

  const DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  let ROWS = []; // [["Lead","Mon","Tue",...], ...] from Sheet
  let edits = new Map(); // key: r_c => value

  function $(id){ return document.getElementById(id); }
  function setStatus(msg, dim=false){ $("status").textContent = msg||""; $("status").classList.toggle("dim", !!dim); $("footStatus").textContent = msg||"Ready."; }

  function a(href, text){
    const x = document.createElement("a");
    x.href = href; x.textContent = text; x.target = "_blank"; x.rel="noopener";
    return x;
  }
  function mail(link){
    const x = document.createElement("a"); x.href = "mailto:"+link; x.textContent = "üìß "+link; return x;
  }
  function tel(link){
    const plain = (link||"").replace(/[^0-9+]/g,"");
    const x = document.createElement("a"); x.href = "tel:"+plain; x.textContent = "‚òé "+link; return x;
  }

  function formatLeadCell(name){
    const wrap = document.createElement("div"); wrap.className="lead";
    const nm = document.createElement("div"); nm.className="name"; nm.textContent = name||"‚Äî"; wrap.appendChild(nm);
    const info = CONTACTS[name];
    if (info){
      const meta = document.createElement("div"); meta.className="meta";
      if (info.email) meta.appendChild(mail(info.email));
      if (info.phone) meta.appendChild(tel(info.phone));
      if (info.website){
        const w = document.createElement("a"); w.href = info.website; w.textContent = "üåê Website"; w.target="_blank"; w.rel="noopener";
        meta.appendChild(w);
      }
      wrap.appendChild(meta);
    }
    return wrap;
  }

  async function load(){
    try{
      setStatus("Loading‚Ä¶");
      const r = await fetch(API, { method:"GET" });
      if (!r.ok) throw new Error("Could not load. Check the API URL and permissions.");
      const data = await r.json(); // 2D array
      ROWS = data;
      buildTable();
      setStatus("Loaded.", true);
    }catch(err){
      console.error(err);
      setStatus(err.message || "Load failed.");
      alert(err.message || "Load failed. Check Web App access (Anyone with the link).");
    }
  }

  function buildTable(){
    const tb = $("tbody");
    tb.innerHTML = "";
    edits.clear();
    // ROWS[0] is header
    for (let r=1; r<ROWS.length; r++){ // start at row 1 (skip header)
      const row = ROWS[r];
      const lead = row[0] || "";
      const tr = document.createElement("tr");

      const th = document.createElement("th");
      th.appendChild(formatLeadCell(lead));
      tr.appendChild(th);

      for (let c=0; c<7; c++){
        const id = `${r-1}_${c}`; // r-1 maps to 0-based data index
        const td = document.createElement("td");
        const ta = document.createElement("textarea");
        ta.id = id;
        ta.value = row[c+1] || "";
        ta.addEventListener("input", ()=>{ edits.set(id, ta.value); setStatus("Unsaved changes‚Ä¶"); });
        td.appendChild(ta);
        tr.appendChild(td);
      }
      tb.appendChild(tr);
    }
  }

  async function save(){
    if (edits.size===0) { setStatus("No changes to save.", true); return; }
    try{
      setStatus("Saving‚Ä¶");
      const rows = [];
      edits.forEach((value, key)=>{ const [ri, ci] = key.split("_").map(Number); rows.push({ rowIndex: ri, colIndex: ci, value }); });
      const resp = await fetch(API, { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({rows}) });
      const ok = await resp.json();
      if (!ok || !ok.ok) throw new Error("Save failed.");
      setStatus("Saved.", true);
      edits.clear();
    }catch(err){
      console.error(err);
      setStatus("Save failed.");
      alert("Save failed. Check Apps Script deployment permissions (Web app ‚Üí Anyone with the link).");
    }
  }

  $("btnRefresh").addEventListener("click", load);
  $("btnSave").addEventListener("click", save);

  // Boot
  load();
</script>
</body>
</html>
