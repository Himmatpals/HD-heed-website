<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>HD HeeD • QR Code Generator</title>
<style>
:root {
  --bg-dark-1: #0a0f1a;
  --bg-dark-2: #0f172a;
  --bg-card: rgba(15,23,42,0.9);
  --border-card: rgba(255,255,255,0.07);
  --text-main: #ffffff;
  --text-dim: #94a3b8;
  --accent: #38bdf8;
  --accent-strong: #0ea5e9;
  --radius-lg: 1rem;
  --radius-md: .5rem;
  --radius-xl: 1.25rem;
  --err: #f87171;
  --shadow-card:
    0 30px 80px rgba(0,0,0,.9),
    0 0 120px rgba(56,189,248,.18),
    0 0 240px rgba(14,165,233,.28);
  --shadow-btn:
    0 20px 40px rgba(56,189,248,.4);
}
* {
  box-sizing:border-box;
  -webkit-font-smoothing: antialiased;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Inter",Roboto,"Helvetica Neue",Arial,sans-serif;
}
body {
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:1.5rem;
  background:
    radial-gradient(circle at 20% 20%, rgba(56,189,248,0.18) 0%, transparent 60%),
    radial-gradient(circle at 80% 30%, rgba(14,165,233,0.07) 0%, transparent 70%),
    linear-gradient(160deg, var(--bg-dark-1) 0%, var(--bg-dark-2) 100%);
  color:var(--text-main);
}

/* HEADER BRAND BAR */
.brand-bar{
  width:100%;
  max-width:480px;
  background:rgba(0,0,0,0.4);
  border:1px solid rgba(56,189,248,0.4);
  border-radius:var(--radius-md);
  box-shadow:0 20px 60px rgba(0,0,0,.8),
             0 0 80px rgba(56,189,248,.4);
  padding:.9rem 1rem;
  display:flex;
  flex-direction:row;
  align-items:flex-start;
  justify-content:space-between;
  gap:.75rem;
}
.brand-left{
  display:flex;
  flex-direction:column;
}
.logo-text{
  display:flex;
  align-items:baseline;
  gap:.5rem;
  font-size:1rem;
  font-weight:600;
  letter-spacing:-0.03em;
  color:var(--accent);
}
.logo-text span.small-tag{
  font-size:.65rem;
  font-weight:500;
  color:#0f172a;
  background:linear-gradient(90deg,#0ea5e9 0%,#38bdf8 100%);
  border-radius:999px;
  padding:.15rem .5rem;
  line-height:1.2;
  box-shadow:0 10px 25px rgba(56,189,248,.5);
}
.brand-left .subtitle{
  font-size:.7rem;
  line-height:1.3;
  color:var(--text-dim);
  max-width:36ch;
}
.brand-right{
  font-size:.65rem;
  line-height:1.3;
  color:var(--text-dim);
  text-align:right;
}
.brand-right b{
  color:var(--text-main);
  font-weight:500;
}

/* CARD SHELL */
.app-card{
  margin-top:1.5rem;
  width:100%;
  max-width:480px;
  background:var(--bg-card);
  border:1px solid var(--border-card);
  border-radius:var(--radius-xl);
  box-shadow:var(--shadow-card);
  padding:1.5rem 1.25rem 1.75rem;
  display:flex;
  flex-direction:column;
  gap:1.25rem;
  position:relative;
}

/* TITLE AREA INSIDE CARD */
.card-head h1{
  margin:0 0 .4rem;
  font-size:1rem;
  font-weight:600;
  color:var(--text-main);
  display:flex;
  align-items:center;
  gap:.5rem;
  letter-spacing:-0.03em;
}
.card-head h1 .badge-offline{
  background:rgba(56,189,248,.15);
  border:1px solid rgba(56,189,248,.4);
  color:var(--accent);
  font-size:.65rem;
  font-weight:500;
  padding:.2rem .5rem;
  line-height:1.2;
  border-radius:var(--radius-md);
}
.card-head p{
  margin:0;
  font-size:.8rem;
  line-height:1.4;
  color:var(--text-dim);
}

/* INPUT BLOCK */
.field-block label{
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:.8rem;
  color:var(--text-main);
  font-weight:500;
  margin-bottom:.5rem;
}
.field-block small{
  font-size:.7rem;
  font-weight:400;
  color:var(--text-dim);
}
.input-row{
  display:flex;
  align-items:stretch;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius-md);
  overflow:hidden;
  box-shadow:inset 0 0 20px rgba(0,0,0,.6);
}
.input-row:focus-within{
  border-color:rgba(56,189,248,.6);
  box-shadow:
    0 0 20px rgba(56,189,248,.4),
    0 0 80px rgba(14,165,233,.2),
    inset 0 0 20px rgba(0,0,0,.6);
}
#qrText{
  flex:1;
  background:transparent;
  border:0;
  outline:0;
  color:var(--text-main);
  font-size:.9rem;
  line-height:1.4;
  padding:1rem .9rem;
  min-width:0;
}
#qrText::placeholder{
  color:#475569;
}
.copy-btn{
  min-width:70px;
  background:transparent;
  color:var(--accent);
  font-size:.75rem;
  font-weight:500;
  border:0;
  border-left:1px solid rgba(255,255,255,.08);
  padding:0 .9rem;
  cursor:pointer;
}
.copy-btn:hover{
  background:rgba(255,255,255,.05);
  color:var(--accent-strong);
}

.btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:.75rem;
}
button.primary{
  appearance:none;
  cursor:pointer;
  background:
    radial-gradient(circle at 0% 0%, rgba(56,189,248,.25) 0%, rgba(0,0,0,0) 70%),
    linear-gradient(90deg,#0ea5e9 0%,#38bdf8 100%);
  border:1px solid rgba(255,255,255,.2);
  color:#0f172a;
  font-weight:600;
  font-size:.8rem;
  line-height:1.2;
  padding:.8rem 1rem;
  border-radius:var(--radius-md);
  box-shadow:var(--shadow-btn);
  min-width:140px;
}
button.primary:active{
  transform:scale(.98);
}
button.ghost{
  appearance:none;
  cursor:pointer;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.03);
  color:var(--text-main);
  font-weight:500;
  font-size:.8rem;
  line-height:1.2;
  padding:.8rem 1rem;
  border-radius:var(--radius-md);
  min-width:140px;
}
button.ghost:disabled{
  opacity:.4;
  cursor:not-allowed;
}
button.ghost:not(:disabled):hover{
  background:rgba(255,255,255,.05);
}
button.ghost:not(:disabled):active{
  background:rgba(255,255,255,.07);
  transform:scale(.98);
}

.error-area{
  min-height:1.2em;
  font-size:.75rem;
  line-height:1.4;
  color:var(--err);
}

/* QR PREVIEW BLOCK */
.preview-card{
  background:rgba(0,0,0,.4);
  border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius-lg);
  box-shadow:
    0 30px 60px rgba(0,0,0,.9),
    0 0 80px rgba(56,189,248,.25),
    0 0 160px rgba(14,165,233,.4);
  padding:1rem;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:.75rem;
}
.qr-box-area{
  width:220px;
  height:220px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at 50% 30%,rgba(255,255,255,.07)0%,rgba(0,0,0,0)70%);
  position:relative;
  border-radius:var(--radius-lg);
}
#qrCanvas{
  width:200px;
  height:200px;
  background:#ffffff;
  border-radius:var(--radius-md);
  image-rendering:pixelated;
}
.qr-hint{
  font-size:.7rem;
  line-height:1.4;
  color:var(--text-dim);
  text-align:center;
  max-width:30ch;
}

/* FOOTER */
.app-footer{
  margin-top:1rem;
  width:100%;
  max-width:480px;
  text-align:center;
  font-size:.7rem;
  line-height:1.4;
  color:var(--text-dim);
  background:rgba(0,0,0,0.3);
  border:1px solid rgba(255,255,255,0.07);
  border-radius:var(--radius-md);
  padding:.75rem 1rem;
  box-shadow:0 20px 50px rgba(0,0,0,.8),
             0 0 80px rgba(56,189,248,.2);
}
.app-footer b{
  color:var(--accent);
  font-weight:500;
}
</style>
</head>
<body>

<!-- BRAND BAR -->
<header class="brand-bar">
  <div class="brand-left">
    <div class="logo-text">
      <span>HD HeeD</span>
      <span class="small-tag">Because we care</span>
    </div>
    <div class="subtitle">
      RN-led NDIS & aged care support.
      Safe QR generator for posters, forms, and referrals.
    </div>
  </div>
  <div class="brand-right">
    <div><b>02&nbsp;8630&nbsp;5500</b></div>
    <div>info@hdheed.com.au</div>
    <div>hdheed.com.au</div>
  </div>
</header>

<!-- MAIN CARD -->
<section class="app-card">
  <div class="card-head">
    <h1>
      QR Code Generator
      <span class="badge-offline">Offline</span>
    </h1>
    <p>Paste any link (or plain text). Generate a scannable QR code. Download as PNG. 100% local — no upload.</p>
  </div>

  <div class="field-block">
    <label for="qrText">
      Enter URL or text
      <small id="lengthInfo">0 characters</small>
    </label>

    <div class="input-row">
      <input
        id="qrText"
        type="text"
        placeholder="https://hdheed.com.au/referral"
        autocomplete="off"
      />
      <button class="copy-btn" id="copyBtn" type="button">Copy</button>
    </div>
  </div>

  <div class="btn-row">
    <button class="primary" id="generateBtn" type="button">
      Generate QR
    </button>

    <button class="ghost" id="downloadBtn" type="button" disabled>
      Download PNG
    </button>
  </div>

  <div class="error-area" id="errorArea"></div>

  <div class="preview-card">
    <div class="qr-box-area">
      <canvas id="qrCanvas" width="200" height="200"></canvas>
    </div>
    <div class="qr-hint" id="qrHint">
      Your QR will appear here. Scan with your phone camera to test.
    </div>
  </div>
</section>

<footer class="app-footer">
  <b>Note:</b> You can print this QR on admission packs, fridge magnets, resident room signage, manual, etc. The data stays on your device.
</footer>

<script>
/*
  Minimal self-contained QR encoder.
  This is a compact, adapted version of "QRCode for JavaScript" by Kazuhiko Arase (public domain).
  ECC level: M
*/

(function(global){
  function QR8bitByte(data){this.mode=1;this.data=data;}
  QR8bitByte.prototype={
    getLength:function(){return this.data.length;},
    write:function(buffer){
      for(var i=0;i<this.data.length;i++){
        buffer.put(this.data.charCodeAt(i),8);
      }
    }
  };

  function QRBitBuffer(){
    this.buffer=[];
    this.length=0;
  }
  QRBitBuffer.prototype={
    get:function(i){
      return ((this.buffer[Math.floor(i/8)] >>> (7 - i % 8)) & 1)==1;
    },
    put:function(num,length){
      for(var i=0;i<length;i++){
        this.putBit(((num >>> (length - i - 1)) & 1)==1);
      }
    },
    getLengthInBits:function(){
      return this.length;
    },
    putBit:function(bit){
      if(this.length==this.buffer.length*8){
        this.buffer.push(0);
      }
      if(bit){
        this.buffer[this.buffer.length-1] |= (0x80 >>> (this.length % 8));
      }
      this.length++;
    }
  };

  var QRUtil={
    PATTERN_POSITION_TABLE:[
      [],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],
      [6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],
      [6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],
      [6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],
      [6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],
      [6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],
      [6,26,54,82,110,138,166],[6,30,58,86,114,142,170]
    ],
    getBCHTypeInfo:function(data){
      var d=data<<10;
      while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(1335)>=0){
        d^=(1335<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(1335)));
      }
      return ((data<<10)|d)^21522;
    },
    getBCHTypeNumber:function(data){
      var d=data<<12;
      while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(7973)>=0){
        d^=(7973<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(7973)));
      }
      return (data<<12)|d;
    },
    getBCHDigit:function(data){
      var digit=0;
      while(data!=0){
        digit++;
        data>>>=1;
      }
      return digit;
    },
    getPatternPosition:function(typeNumber){
      return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1];
    },
    getMask:function(maskPattern,i,j){
      switch(maskPattern){
        case 0:return (i+j)%2===0;
        case 1:return i%2===0;
        case 2:return j%3===0;
        case 3:return (i+j)%3===0;
        case 4:return (Math.floor(i/2)+Math.floor(j/3))%2===0;
        case 5:return ((i*j)%2)+((i*j)%3)===0;
        case 6:return (((i*j)%2)+((i*j)%3))%2===0;
        case 7:return (((i*j)%3)+((i+j)%2))%2===0;
        default:throw new Error("bad maskPattern:"+maskPattern);
      }
    },
    getErrorCorrectPolynomial:function(errorCorrectLength){
      var a=new QRPolynomial([1],0);
      for(var i=0;i<errorCorrectLength;i++){
        a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0));
      }
      return a;
    },
    getLengthInBits:function(mode,typeNumber){
      if(1<=typeNumber && typeNumber<10){
        if(mode==1){return 8;}
      }else if(typeNumber<27){
        if(mode==1){return 16;}
      }else if(typeNumber<41){
        if(mode==1){return 16;}
      }
      throw new Error("typeNumber:"+typeNumber);
    },
    getLostPoint:function(qrCode){
      var moduleCount=qrCode.getModuleCount();
      var lostPoint=0;

      // Adjacent modules in row/column
      for(var row=0;row<moduleCount;row++){
        for(var col=0;col<moduleCount;col++){
          var sameCount=0;
          var dark=qrCode.isDark(row,col);
          for(var r=-1;r<=1;r++){
            if(row+r<0||moduleCount<=row+r){continue;}
            for(var c=-1;c<=1;c++){
              if(col+c<0||moduleCount<=col+c){continue;}
              if(r==0 && c==0){continue;}
              if(dark==qrCode.isDark(row+r,col+c)){sameCount++;}
            }
          }
          if(sameCount>5){lostPoint+=(3+sameCount-5);}
        }
      }

      // 2x2 blocks
      for(row=0;row<moduleCount-1;row++){
        for(col=0;col<moduleCount-1;col++){
          var count=0;
          if(qrCode.isDark(row,col))count++;
          if(qrCode.isDark(row+1,col))count++;
          if(qrCode.isDark(row,col+1))count++;
          if(qrCode.isDark(row+1,col+1))count++;
          if(count==0||count==4){lostPoint+=3;}
        }
      }

      // finder-like patterns in rows
      for(row=0;row<moduleCount;row++){
        for(col=0;col<moduleCount-6;col++){
          if(qrCode.isDark(row,col)
            &&!qrCode.isDark(row,col+1)
            &&qrCode.isDark(row,col+2)
            &&qrCode.isDark(row,col+3)
            &&qrCode.isDark(row,col+4)
            &&!qrCode.isDark(row,col+5)
            &&qrCode.isDark(row,col+6)){
            lostPoint+=40;
          }
        }
      }

      // finder-like patterns in cols
      for(col=0;col<moduleCount;col++){
        for(row=0;row<moduleCount-6;row++){
          if(qrCode.isDark(row,col)
            &&!qrCode.isDark(row+1,col)
            &&qrCode.isDark(row+2,col)
            &&qrCode.isDark(row+3,col)
            &&qrCode.isDark(row+4,col)
            &&!qrCode.isDark(row+5,col)
            &&qrCode.isDark(row+6,col)){
            lostPoint+=40;
          }
        }
      }

      // balance
      var darkCount=0;
      for(var r2=0;r2<moduleCount;r2++){
        for(var c2=0;c2<moduleCount;c2++){
          if(qrCode.isDark(r2,c2)){
            darkCount++;
          }
        }
      }
      var ratio=Math.abs(100*darkCount/moduleCount/moduleCount-50)/5;
      lostPoint+=ratio*10;

      return lostPoint;
    }
  };

  var QRMath={
    glog:function(n){
      if(n<1){throw new Error("glog("+n+")");}
      return QRMath.LOG_TABLE[n];
    },
    gexp:function(n){
      while(n<0){n+=255;}
      while(n>=256){n-=255;}
      return QRMath.EXP_TABLE[n];
    },
    EXP_TABLE:new Array(256),
    LOG_TABLE:new Array(256)
  };

  for(var i=0;i<8;i++){
    QRMath.EXP_TABLE[i]=1<<i;
  }
  for(i=8;i<256;i++){
    QRMath.EXP_TABLE[i]=
      QRMath.EXP_TABLE[i-4]^
      QRMath.EXP_TABLE[i-5]^
      QRMath.EXP_TABLE[i-6]^
      QRMath.EXP_TABLE[i-8];
  }
  for(i=0;i<255;i++){
    QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;
  }

  function QRPolynomial(num,shift){
    var offset=0;
    while(offset<num.length && num[offset]==0){offset++;}
    this.num=new Array(num.length-offset+shift);
    for(var i2=0;i2<num.length-offset;i2++){
      this.num[i2]=num[i2+offset];
    }
  }
  QRPolynomial.prototype={
    get:function(index){return this.num[index];},
    getLength:function(){return this.num.length;},
    multiply:function(e){
      var num=new Array(this.getLength()+e.getLength()-1);
      for(var i3=0;i3<this.getLength();i3++){
        for(var j=0;j<e.getLength();j++){
          num[i3+j]^=
            QRMath.gexp(
              QRMath.glog(this.get(i3))+
              QRMath.glog(e.get(j))
            );
        }
      }
      return new QRPolynomial(num,0);
    },
    mod:function(e){
      if(this.getLength()-e.getLength()<0){
        return this;
      }
      var ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));
      var num=new Array(this.getLength());
      for(var i4=0;i4<this.getLength();i4++){
        num[i4]=this.get(i4);
      }
      for(i4=0;i4<e.getLength();i4++){
        num[i4]^=
          QRMath.gexp(
            QRMath.glog(e.get(i4))+ratio
          );
      }
      return new QRPolynomial(num,0).mod(e);
    }
  };

  function QRRSBlock() {}
  QRRSBlock.RS_BLOCK_TABLE=[
    // version, blocks, dataCount, totalCount (ECC M) simplified pack
    [1,1,16,26],[2,1,28,44],[3,1,44,70],[4,1,64,100],[5,1,86,134],[6,2,108,172],
    [7,2,124,196],[8,2,154,242],[9,2,182,292],[10,4,216,346],[11,4,254,404],
    [12,4,290,466],[13,4,334,532],[14,4,365,581],[15,6,415,655],[16,6,453,733],
    [17,6,507,815],[18,6,563,901],[19,7,627,991],[20,8,669,1085],[21,8,714,1156],
    [22,9,782,1258],[23,9,860,1364],[24,10,914,1474],[25,12,1000,1588],[26,12,1062,1706],
    [27,12,1128,1828],[28,13,1193,1921],[29,14,1267,2051],[30,15,1373,2185],
    [31,16,1455,2323],[32,17,1541,2465],[33,18,1631,2611],[34,19,1725,2761],
    [35,19,1812,2876],[36,20,1914,3034],[37,21,1992,3196],[38,22,2102,3362],
    [39,24,2216,3532],[40,25,2334,3728]
  ];
  QRRSBlock.getRSBlocks=function(typeNumber){
    var rs=QRRSBlock.RS_BLOCK_TABLE[typeNumber-1];
    if(!rs){throw new Error("bad typeNumber:"+typeNumber);}
    var list=[];
    var blocks=rs[1];
    var dataCount=Math.floor(rs[2]/blocks);
    var totalCount=Math.floor(rs[3]/blocks);
    for(var i5=0;i5<blocks;i5++){
      list.push({dataCount:dataCount,totalCount:totalCount});
    }
    return list;
  };

  function QRCode(typeNumber){
    this.typeNumber=typeNumber;
    this.moduleCount=0;
    this.modules=null;
    this.dataList=[];
    this.dataCache=null;
    this.errorCorrectLevel="M";
  }
  QRCode.prototype={
    addData:function(data){
      this.dataList.push(new QR8bitByte(data));
      this.dataCache=null;
    },
    isDark:function(row,col){
      if(this.modules[row][col]==null){return false;}
      return this.modules[row][col];
    },
    getModuleCount:function(){return this.moduleCount;},
    make:function(){
      this.makeImpl(false,this.getBestMaskPattern());
    },
    getBestMaskPattern:function(){
      var minLostPoint=0;
      var pattern=0;
      for(var i6=0;i6<8;i6++){
        this.makeImpl(true,i6);
        var lostPoint=QRUtil.getLostPoint(this);
        if(i6==0||minLostPoint>lostPoint){
          minLostPoint=lostPoint;
          pattern=i6;
        }
      }
      return pattern;
    },
    makeImpl:function(test,maskPattern){
      this.moduleCount=this.typeNumber*4+17;
      this.modules=new Array(this.moduleCount);
      for(var row=0;row<this.moduleCount;row++){
        this.modules[row]=new Array(this.moduleCount);
        for(var col=0;col<this.moduleCount;col++){
          this.modules[row][col]=null;
        }
      }
      this.setupPositionProbePattern(0,0);
      this.setupPositionProbePattern(this.moduleCount-7,0);
      this.setupPositionProbePattern(0,this.moduleCount-7);
      this.setupPositionAdjustPattern();
      this.setupTimingPattern();
      this.setupTypeInfo(test,maskPattern);
      this.setupTypeNumber(test);

      this.dataCache=this.createData();
      this.mapData(this.dataCache,maskPattern);
    },
    setupPositionProbePattern:function(row,col){
      for(var r=-1;r<=7;r++){
        if(row+r<=-1||this.moduleCount<=row+r)continue;
        for(var c=-1;c<=7;c++){
          if(col+c<=-1||this.moduleCount<=col+c)continue;
          if((0<=r&&r<=6&&(c==0||c==6))||
             (0<=c&&c<=6&&(r==0||r==6))||
             (2<=r&&r<=4&&2<=c&&c<=4)){
            this.modules[row+r][col+c]=true;
          }else{
            this.modules[row+r][col+c]=false;
          }
        }
      }
    },
    setupTimingPattern:function(){
      for(var r=8;r<this.moduleCount-8;r++){
        if(this.modules[r][6]!=null)continue;
        this.modules[r][6]=(r%2==0);
      }
      for(var c=8;c<this.moduleCount-8;c++){
        if(this.modules[6][c]!=null)continue;
        this.modules[6][c]=(c%2==0);
      }
    },
    setupPositionAdjustPattern:function(){
      var pos=QRUtil.getPatternPosition(this.typeNumber);
      for(var i7=0;i7<pos.length;i7++){
        for(var j2=0;j2<pos.length;j2++){
          var row=pos[i7],col=pos[j2];
          if(this.modules[row][col]!=null)continue;
          for(var r=-2;r<=2;r++){
            for(var c=-2;c<=2;c++){
              if(r==-2||r==2||c==-2||c==2||(r==0&&c==0)){
                this.modules[row+r][col+c]=true;
              }else{
                this.modules[row+r][col+c]=false;
              }
            }
          }
        }
      }
    },
    setupTypeNumber:function(test){
      var bits=QRUtil.getBCHTypeNumber(this.typeNumber);
      for(var i8=0;i8<18;i8++){
        var mod=((bits>>>(17-i8))&1)==1;
        this.modules[Math.floor(i8/3)][i8%3+this.moduleCount-8-3]=mod;
        this.modules[i8%3+this.moduleCount-8-3][Math.floor(i8/3)]=mod;
      }
    },
    setupTypeInfo:function(test,maskPattern){
      var data=(0<<3)|maskPattern; // ECC M = 0
      var bits=QRUtil.getBCHTypeInfo(data);

      // vertical
      for(var i9=0;i9<15;i9++){
        var mod=((bits>>>(14-i9))&1)==1;
        if(i9<6){
          this.modules[i9][8]=mod;
        }else if(i9<8){
          this.modules[i9+1][8]=mod;
        }else{
          this.modules[this.moduleCount-15+i9][8]=mod;
        }
      }

      // horizontal
      for(i9=0;i9<15;i9++){
        mod=((bits>>>(14-i9))&1)==1;
        if(i9<8){
          this.modules[8][this.moduleCount-15+i9]=mod;
        }else if(i9<9){
          this.modules[8][i9-8]=mod;
        }else{
          this.modules[8][i9-8+1]=mod;
        }
      }

      // fixed module
      this.modules[this.moduleCount-8][8]=true;
    },
    createData:function(){
      var buffer=new QRBitBuffer();
      for(var i10=0;i10<this.dataList.length;i10++){
        var data=this.dataList[i10];
        buffer.put(data.mode,4);
        buffer.put(
          data.getLength(),
          QRUtil.getLengthInBits(data.mode,this.typeNumber)
        );
        data.write(buffer);
      }

      var totalDataCount=0;
      var rsBlocks=QRRSBlock.getRSBlocks(this.typeNumber);
      for(i10=0;i10<rsBlocks.length;i10++){
        totalDataCount+=rsBlocks[i10].dataCount;
      }

      if(buffer.getLengthInBits() > totalDataCount*8){
        throw new Error("code length overflow.");
      }

      // terminator
      if(buffer.getLengthInBits()+4 <= totalDataCount*8){
        buffer.put(0,4);
      }

      // padding to byte
      while(buffer.getLengthInBits()%8!=0){
        buffer.putBit(false);
      }

      // buffer into bytes
      var dataBytes=[];
      for(i10=0;i10<buffer.buffer.length;i10++){
        dataBytes.push(buffer.buffer[i10]);
      }

      // pad bytes
      var padBytes=[0xec,0x11];
      var idx=0;
      while(dataBytes.length<totalDataCount){
        dataBytes.push(padBytes[idx++ & 1]);
      }

      // RS block build
      var offset=0;
      var dcdata=[];
      var ecdata=[];
      for(i10=0;i10<rsBlocks.length;i10++){
        var dcCount=rsBlocks[i10].dataCount;
        var ecCount=rsBlocks[i10].totalCount-dcCount;

        var dc=[];
        for(var j3=0;j3<dcCount;j3++){
          dc.push(dataBytes[offset+j3]);
        }
        offset+=dcCount;

        var rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);
        var rawPoly=new QRPolynomial(dc,0);
        var modPoly=rawPoly.mod(rsPoly);

        var ecArr=[];
        var modLen=modPoly.getLength();
        for(var x=0;x<ecCount-modLen;x++){ecArr.push(0);}
        for(x=0;x<modLen;x++){ecArr.push(modPoly.get(x));}

        dcdata.push(dc);
        ecdata.push(ecArr);
      }

      var totalCodeCount=0;
      for(i10=0;i10<rsBlocks.length;i10++){
        totalCodeCount+=rsBlocks[i10].totalCount;
      }

      var dataOut=[];
      for(i10=0;i10<totalCodeCount;i10++){
        for(var r=0;r<rsBlocks.length;r++){
          if(i10<dcdata[r].length){
            dataOut.push(dcdata[r][i10]);
          }
        }
        for(r=0;r<rsBlocks.length;r++){
          if(i10<ecdata[r].length){
            dataOut.push(ecdata[r][i10]);
          }
        }
      }
      return dataOut;
    },
    mapData:function(data,maskPattern){
      var inc=-1;
      var row=this.moduleCount-1;
      var bitIndex=7;
      var byteIndex=0;

      for(var col=this.moduleCount-1;col>0;col-=2){
        if(col==6) col--;

        for(;;){
          for(var c=0;c<2;c++){
            if(this.modules[row][col-c]==null){
              var dark=false;
              if(byteIndex<data.length){
                dark = ((data[byteIndex] >>> bitIndex) & 1) == 1;
              }
              var mask=QRUtil.getMask(maskPattern,row,col-c);
              if(mask){
                dark=!dark;
              }
              this.modules[row][col-c]=dark;

              bitIndex--;
              if(bitIndex==-1){
                byteIndex++;
                bitIndex=7;
              }
            }
          }
          row+=inc;
          if(row<0||this.moduleCount<=row){
            row-=inc;
            inc=-inc;
            break;
          }
        }
      }
    }
  };

  function bestTypeNumber(text){
    for(var t=1;t<=40;t++){
      try{
        var test=new QRCode(t);
        test.addData(text);
        test.createData(); // overflow check
        return t;
      }catch(e){
        // try bigger version
      }
    }
    throw new Error("Text too long");
  }

  function makeQR(text){
    var typeNum=bestTypeNumber(text);
    var qr=new QRCode(typeNum);
    qr.addData(text);
    qr.make();
    return qr;
  }

  global.__qrMake = makeQR;
})(window);

/* DOM + UI Logic */
const qrText     = document.getElementById("qrText");
const lengthInfo = document.getElementById("lengthInfo");
const errorArea  = document.getElementById("errorArea");
const qrCanvas   = document.getElementById("qrCanvas");
const qrHint     = document.getElementById("qrHint");
const copyBtn    = document.getElementById("copyBtn");
const genBtn     = document.getElementById("generateBtn");
const dlBtn      = document.getElementById("downloadBtn");

const ctx = qrCanvas.getContext("2d");

function drawPlaceholder() {
  ctx.fillStyle = "#ffffff";
  ctx.fillRect(0,0,200,200);
  ctx.fillStyle = "#0f172a";
  ctx.font = "bold 14px system-ui,-apple-system,BlinkMacSystemFont,'Inter',Roboto,Arial,sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("QR Preview",100,102);
}
drawPlaceholder();

function updateLengthInfo() {
  lengthInfo.textContent = qrText.value.length + " characters";
}

function validateInput(str){
  if(!str.trim()){
    return "Please enter a link or some text.";
  }
  if(str.length > 1000){
    return "Too long. Please keep under 1000 characters.";
  }
  return "";
}

function renderQRToCanvas(qrObj, scale=6, border=2){
  const count = qrObj.getModuleCount();
  const sizePx = (count + border*2) * scale;

  // set pixel size (CSS stays 200x200 so it will auto-scale down sharp)
  qrCanvas.width = sizePx;
  qrCanvas.height = sizePx;

  const ctx2 = qrCanvas.getContext("2d");
  ctx2.fillStyle = "#ffffff";
  ctx2.fillRect(0,0,sizePx,sizePx);

  for(let r=0;r<count;r++){
    for(let c=0;c<count;c++){
      ctx2.fillStyle = qrObj.isDark(r,c) ? "#000000" : "#ffffff";
      const x = (c+border)*scale;
      const y = (r+border)*scale;
      ctx2.fillRect(x,y,scale,scale);
    }
  }

  dlBtn.disabled = false;
  qrHint.textContent = "Done. Scan me 📱";
}

function generateQR(){
  const text = qrText.value;
  const err  = validateInput(text);
  errorArea.textContent = err;
  if(err){ return; }

  try{
    const qrData = window.__qrMake(text);
    renderQRToCanvas(qrData, 6, 2);
  }catch(e){
    console.error(e);
    errorArea.textContent = "Could not generate QR for that input.";
  }
}

function downloadPNG(){
  const link = document.createElement("a");
  link.download = "qr-code.png";
  link.href = qrCanvas.toDataURL("image/png");
  link.click();
}

async function copyInput(){
  try{
    await navigator.clipboard.writeText(qrText.value);
    copyBtn.textContent = "Copied";
    setTimeout(()=>{copyBtn.textContent="Copy";},1200);
  }catch(e){
    copyBtn.textContent = "Error";
    setTimeout(()=>{copyBtn.textContent="Copy";},1200);
  }
}

// live counter
qrText.addEventListener("input", updateLengthInfo);

// buttons
genBtn.addEventListener("click", generateQR);
dlBtn.addEventListener("click", downloadPNG);
copyBtn.addEventListener("click", copyInput);

// press Enter to generate
qrText.addEventListener("keydown",(e)=>{
  if(e.key==="Enter"){
    e.preventDefault();
    generateQR();
  }
});
</script>

</body>
</html>
